"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getArrayValuesAsHashmapKeys=exports.getLookupTable=exports.keyOfItemWithProperty=exports.keysOfItemsWithProperty=exports.getDublicates=exports.getId=exports.refreshDataSet=exports.drawRaster=exports.getPrettyFilter=exports.groupByProperty=exports.isEdgeTypeMatch=exports.getEdgeTypeMatches=exports.getDataUri=exports.convert=exports.getValues=exports.getIterableCollection=exports.getLabel=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/* @preserve TW-Guard */
/*\

title: $:/plugins/felixhayashi/tiddlymap/js/lib/utils/tmap
type: application/javascript
module-type: library

@preserve

\*/
/* @preserve TW-Guard */var _vis=require("$:/plugins/felixhayashi/vis/vis.js");var _vis2=_interopRequireDefault(_vis);var _exception=require("$:/plugins/felixhayashi/tiddlymap/js/exception");var _basic=require("$:/plugins/felixhayashi/tiddlymap/js/lib/utils/basic");var basicUtils=_interopRequireWildcard(_basic);var _wiki=require("$:/plugins/felixhayashi/tiddlymap/js/lib/utils/wiki");var wikiUtils=_interopRequireWildcard(_wiki);function _interopRequireWildcard(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t.default=e;return t}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var getLabel=exports.getLabel=function e(t,r){var i=wikiUtils.getTiddler(t);return(i&&i.fields[r]?i.fields[r]:i.fields.title).replace("\\n","\n")};var getIterableCollection=exports.getIterableCollection=function e(t){return t instanceof _vis2.default.DataSet?t.get():t};var getValues=exports.getValues=function e(t){if(Array.isArray(t)){return t}else if(t instanceof _vis2.default.DataSet){return t.get({returnType:"Array"})}var r=[];var i=Object.keys(t);for(var a=i.length;a--;){r.push(t[i[a]])}return r};var convert=exports.convert=function e(t,r){if((typeof t==="undefined"?"undefined":_typeof(t))!=="object"){throw new _exception.InvalidArgumentException(t,r)}if(r==="object"){r="hashmap"}var i={array:function e(t){return getValues(t)},hashmap:function e(t){return t instanceof _vis2.default.DataSet?t.get({returnType:"Object"}):t},dataset:function e(t){return t instanceof _vis2.default.DataSet?t:!Array.isArray(t)?getValues(t):new _vis2.default.DataSet(t)}};return i[r](t)};var getDataUri=exports.getDataUri=function e(t,r,i){var a=wikiUtils.getTiddler(t);r=r||a.fields.type||"text/vnd.tiddlywiki";var s=void 0;if(r==="text/vnd.tiddlywiki"){s=$tw.wiki.renderText("text/html","text/vnd.tiddlywiki","\\define currentTiddler()"+a.fields.title+"\n<$transclude mode=inline/>\n");r="image/svg+xml"}else{s=a.fields.text}var n=$tw.config.contentTypeInfo[r].encoding;if(r==="image/svg+xml"){s=s.replace(/\r?\n|\r/g," ");if(!basicUtils.hasSubString("xmlns",s)){s=s.replace(/<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')}}if(i&&n!=="base64"){n="base64";s=basicUtils.base64(s)}return"data:"+r+";"+n+","+s};var eTyFiltAutoPrefix="[all[]] ";var getEdgeTypeMatches=exports.getEdgeTypeMatches=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var r=arguments[1];if(!r){r=wikiUtils.getTiddlersByPrefix($tm.path.edgeTypes+"/",{iterator:"eachTiddlerPlusShadows",removePrefix:true})}if(r!=null&&!Array.isArray(r)){r=Object.keys(r)}return wikiUtils.getMatches(eTyFiltAutoPrefix+t,r)};var isEdgeTypeMatch=exports.isEdgeTypeMatch=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return wikiUtils.isMatch(t,eTyFiltAutoPrefix+r)};var groupByProperty=exports.groupByProperty=function e(t,r){t=getIterableCollection(t);var i=basicUtils.makeHashMap();var a=Object.keys(t);for(var s in a){var n=t[a[s]];var o=n[r];if(o==null){throw"Cannot group by property "+r}else{if(!Array.isArray(i[o])){i[o]=[]}i[o].push(n)}}return i};var getPrettyFilter=exports.getPrettyFilter=function e(t){t=t.trim().replace("][","] [");var r=/[+-]?\[.+?[\]\}\>]\]/g;var i=t.match(r);t=t.replace(r," [] ").trim();var a=t.split(/\s+/);var s=0;var n=[];for(var o=0,l=a.length;o<l;o++){n[o]=a[o]==="[]"?i[s++]:a[o]}return n.join("\n")};var drawRaster=exports.drawRaster=function e(t,r,i,a){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"#D9D9D9";var n=basicUtils.getNearestRasterPosition(i,a),o=n.x,l=n.y;var u=t.canvas.width/r;var f=t.canvas.height/r;var p=a*2;var v=Math.ceil(u/a/2)*a+p;var d=Math.ceil(f/a/2)*a+p;var c=o-v;var y=o+v;var g=l-d;var h=l+d;t.beginPath();for(var x=c;x<y;x+=a){t.moveTo(x,g);t.lineTo(x,h)}for(var b=g;b<=h;b+=a){t.moveTo(c,b);t.lineTo(y,b)}t.strokeStyle=s;t.fillStyle=s;t.stroke()};var refreshDataSet=exports.refreshDataSet=function e(t,r){var i=t.get({returnType:"Object"});var a=[];var s=[];var n=[];var o=[];for(var l in r){if(i[l]){if(basicUtils.isEqual(i[l],r[l])){continue}s.push(l);t.remove(l)}else{a.push(l)}if(r[l].x===undefined){n.push(l)}t.add(r[l])}for(var u in i){if(!r[u]){o.push(u);t.remove(u)}}return{withoutPosition:n,inserted:a,updated:s,removed:o}};var getId=exports.getId=function e(t){return wikiUtils.getTiddler(t).fields["tmap.id"]};var getDublicates=exports.getDublicates=function e(t){var r=getId(t);if(!r){return[]}var i=wikiUtils.getTiddlersWithField("tmap.id",r,{limit:2});delete i[wikiUtils.getTiddlerRef(t)];return Object.keys(i)};var keysOfItemsWithProperty=exports.keysOfItemsWithProperty=function e(t,r,i,a){t=getIterableCollection(t);var s=Object.keys(t);var n=[];a=typeof a==="number"?a:s.length;for(var o=0,l=s.length;o<l;o++){var u=s[o];if(_typeof(t[u])==="object"&&t[u][r]){if(!i||t[u][r]===i){n.push(u);if(n.length===a){break}}}}return n};var keyOfItemWithProperty=exports.keyOfItemWithProperty=function e(t,r,i){return keysOfItemsWithProperty(t,r,i,1)[0]};var getLookupTable=exports.getLookupTable=function e(t,r){t=getIterableCollection(t);var i=basicUtils.makeHashMap();var a=Object.keys(t);for(var s=0,n=a.length;s<n;s++){var o=a[s];var l=r?t[o][r]:t[o];var u=typeof l==="undefined"?"undefined":_typeof(l);if(u==="string"&&l!==""||u==="number"){if(!i[l]){i[l]=r?t[o]:true;continue}}if(r){throw new Error('Cannot use "'+l+'" as lookup table index')}}return i};var getArrayValuesAsHashmapKeys=exports.getArrayValuesAsHashmapKeys=getLookupTable;